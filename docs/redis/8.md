## Redis持久化选择

* RDB快照
* AOF

RDB
* save
    * 会阻塞客户端的命令
* bgsave 
    * 不会阻塞客户端命令，但是会额外的消耗内存
    * 另起一个fork线程处理备份
* 处理方式
    * 定时器
    * 60秒内发生了1000次操作写入时执行
* 问题
    * 耗时，耗性能
    * 不可控
    
AOF
* always：每条redis写命令都同步写入硬盘
* everysec：每秒执行一次，将多条命令写入硬盘
* no：由操作系统自己决定何时写入
* 问题
    * always：io开销大，不会出问题
    * everysec：丢失1s的数据
    * no：不可控
    * aof文件会持续增长，需要重写
* aof重写策略
    * bgrewriteaof：创建一个子进程进行重写
    * aof重写配置
* 如何选择
    * 如果可以完全丢弃可以选择不持久化
    * 可以接受十几分钟或者更多的数据丢失，选择rdb
    * 主从情况下：master关闭持久化，保持性能开销，slaver开启aof，并且定时对持久化数据进行备份，关闭aof的自动重写，添加定时任务，调用bgrewriteaof进行重写